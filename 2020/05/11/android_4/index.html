<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="good good study"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.5"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.5"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><title>Fragment 监听返回按键 | wzmyyj</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Fragment 监听返回按键</h1><a id="logo" href="/.">wzmyyj</a><p class="description">Let life be beautiful like summer flowers.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Fragment 监听返回按键</h1><div class="post-meta"><a href="/2020/05/11/android_4/#comments" class="comment-count"></a><p><span class="date">May 11, 2020</span></p></div><div class="post-content"><h2 id="监听返回键"><a href="#监听返回键" class="headerlink" title="监听返回键"></a>监听返回键</h2><p>Android开发中，我们用fragment承担页面UI主要的逻辑，简化activity逻辑。有个场景，fragment需要监听返回键。但fragment不像activity能感知物理按键。</p>
<a id="more"></a>
<h3 id="过去"><a href="#过去" class="headerlink" title="过去"></a>过去</h3><p>我们会写一个监听接口，让fragment实现。然后activity遍历（或根据tag）找到需要的fragment，在按返回键时，主动将事件下发给fragment。</p>
<p>虽然实现了fragment监听返回键的效果，但是代码需要侵入到activity，并不利于维护。google官方也考虑到了这个问题。</p>
<h3 id="现在"><a href="#现在" class="headerlink" title="现在"></a>现在</h3><p>在新版的AndroidX中：<code>ComponentActivity</code>中增加了<code>OnBackPressedDispatcher</code>（用于注册返回键监听）。</p>
<p>activity继承关系如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/3262738-a0a3b96b46bac1a5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="WechatIMG9.jpeg" title="WechatIMG9.jpeg"> </p>
<p>新的fragment监听方案：</p>
<p><strong>关键类</strong>：OnBackPressedCallback，OnBackPressedDispatcher，ComponentActivity。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义返回键监听事件。</span></span><br><span class="line"><span class="keyword">val</span> callback = <span class="keyword">object</span> : OnBackPressedCallback(<span class="literal">false</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">handleOnBackPressed</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="comment">//do some thing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册监听事件。activity为ComponentActivity的子类对象即可。并绑定生命周期。</span></span><br><span class="line">activity<span class="selector-class">.onBackPressedDispatcher</span><span class="selector-class">.addCallback</span>(lifecycleOwner, callback)</span><br><span class="line"><span class="comment">// 也可以不绑定生命周期。</span></span><br><span class="line">activity<span class="selector-class">.onBackPressedDispatcher</span><span class="selector-class">.addCallback</span>(callback)</span><br></pre></td></tr></table></figure>
<p><code>OnBackPressedCallback</code>可以设置<code>enabled</code>，可以灵活控制要不要消费返回键点击事件。</p>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><p>所有代码都在fragment里。不需要要求activity写多余的逻辑。只要能拿到activity对象和所在的lifecycleOwner即可完成监听任务。甚至是在自定义view中。</p>
<h4 id="深入源码"><a href="#深入源码" class="headerlink" title="深入源码"></a>深入源码</h4><p><code>OnBackPressedCallback</code>：用于处理<code>OnBackPressedDispatcher.onBackPressed()</code>回调而无需将该实现与的子类强耦合的类ComponentActivity。源码比较简单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">OnBackPressedCallback</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mEnabled;</span><br><span class="line">    <span class="keyword">private</span> CopyOnWriteArrayList&lt;Cancellable&gt; mCancellables = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a &#123;<span class="doctag">@link</span> OnBackPressedCallback&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> enabled The default enabled state for this callback.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setEnabled(boolean)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OnBackPressedCallback</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</span><br><span class="line">        mEnabled = enabled;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the enabled state of the callback. Only when this callback</span></span><br><span class="line"><span class="comment">     * is enabled will it receive callbacks to &#123;<span class="doctag">@link</span> #handleOnBackPressed()&#125;.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Note that the enabled state is an additional layer on top of the</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> androidx.lifecycle.LifecycleOwner&#125; passed to</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> OnBackPressedDispatcher#addCallback(LifecycleOwner, OnBackPressedCallback)&#125;</span></span><br><span class="line"><span class="comment">     * which controls when the callback is added and removed to the dispatcher.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> enabled whether the callback should be considered enabled</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</span><br><span class="line">        mEnabled = enabled;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Checks whether this callback should be considered enabled. Only when this callback</span></span><br><span class="line"><span class="comment">     * is enabled will it receive callbacks to &#123;<span class="doctag">@link</span> #handleOnBackPressed()&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Whether this callback should be considered enabled.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mEnabled;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes this callback from any &#123;<span class="doctag">@link</span> OnBackPressedDispatcher&#125; it is currently</span></span><br><span class="line"><span class="comment">     * added to.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Cancellable cancellable: mCancellables) &#123;</span><br><span class="line">            cancellable.cancel();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Callback for handling the &#123;<span class="doctag">@link</span> OnBackPressedDispatcher#onBackPressed()&#125; event.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">handleOnBackPressed</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addCancellable</span><span class="params">(@NonNull Cancellable cancellable)</span> </span>&#123;</span><br><span class="line">        mCancellables.add(cancellable);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeCancellable</span><span class="params">(@NonNull Cancellable cancellable)</span> </span>&#123;</span><br><span class="line">        mCancellables.remove(cancellable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>OnBackPressedDispatcher</code>：存放监听的容器，通过它统一执行。</p>
<p><strong>储存结构：</strong></p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 利用一个队列存储回调。    </span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"WeakerAccess"</span>) <span class="comment">/* synthetic access */</span></span><br><span class="line"><span class="keyword">final</span> ArrayDeque&lt;OnBackPressedCallback&gt; mOnBackPressedCallbacks = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p><strong>是否有有效回调：</strong><br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">hasEnabledCallbacks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Iterator&lt;OnBackPressedCallback&gt; iterator =</span><br><span class="line">                mOnBackPressedCallbacks.descendingIterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (iterator.next().isEnabled()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>执行顺序：</strong><br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按先注册顺序遍历，只执行enabled为true的回调。</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Iterator&lt;OnBackPressedCallback&gt; iterator =</span><br><span class="line">                mOnBackPressedCallbacks.descendingIterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            OnBackPressedCallback callback = iterator.next();</span><br><span class="line">            <span class="keyword">if</span> (callback.isEnabled()) &#123;</span><br><span class="line">                callback.handleOnBackPressed();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mFallbackOnBackPressed != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mFallbackOnBackPressed.run();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>绑定生命周期原理：</strong><br><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@MainThread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> addCallback(<span class="keyword">@NonNull</span> LifecycleOwner owner,</span><br><span class="line">            <span class="keyword">@NonNull</span> OnBackPressedCallback onBackPressedCallback) &#123;</span><br><span class="line">        Lifecycle lifecycle = owner.getLifecycle();</span><br><span class="line">        <span class="keyword">if</span> (lifecycle.getCurrentState() == Lifecycle.State.DESTROYED) &#123;</span><br><span class="line">            <span class="keyword">return</span>;  <span class="comment">// 无视已经死亡的。</span></span><br><span class="line">        &#125;</span><br><span class="line">        onBackPressedCallback.addCancellable(</span><br><span class="line">                <span class="keyword">new</span> LifecycleOnBackPressedCancellable(lifecycle, onBackPressedCallback));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>LifecycleOnBackPressedCancellable 监听生命周期变化，决定是否cancel掉监听。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">LifecycleOnBackPressedCancellable</span> <span class="keyword">implements</span> <span class="title">LifecycleEventObserver</span>,</span></span><br><span class="line"><span class="class">            <span class="title">Cancellable</span> &#123;</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Lifecycle mLifecycle;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> OnBackPressedCallback mOnBackPressedCallback;</span><br><span class="line">        <span class="meta">@Nullable</span></span><br><span class="line">        <span class="keyword">private</span> Cancellable mCurrentCancellable;</span><br><span class="line">        LifecycleOnBackPressedCancellable(<span class="meta">@NonNull</span> Lifecycle lifecycle,</span><br><span class="line">                <span class="meta">@NonNull</span> OnBackPressedCallback onBackPressedCallback) &#123;</span><br><span class="line">            mLifecycle = lifecycle;</span><br><span class="line">            mOnBackPressedCallback = onBackPressedCallback;</span><br><span class="line">            lifecycle.addObserver(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> onStateChanged(<span class="meta">@NonNull</span> LifecycleOwner source,</span><br><span class="line">                <span class="meta">@NonNull</span> Lifecycle.Event event) &#123;</span><br><span class="line">            <span class="keyword">if</span> (event == Lifecycle.Event.ON_START) &#123;</span><br><span class="line">                <span class="comment">// 此时为有效。</span></span><br><span class="line">                mCurrentCancellable = addCancellableCallback(mOnBackPressedCallback);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event == Lifecycle.Event.ON_STOP) &#123;</span><br><span class="line">                <span class="comment">// Should always be non-null</span></span><br><span class="line">                <span class="keyword">if</span> (mCurrentCancellable != <span class="literal">null</span>) &#123;</span><br><span class="line">                    mCurrentCancellable.cancel();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event == Lifecycle.Event.ON_DESTROY) &#123;</span><br><span class="line">                cancel();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> cancel() &#123;</span><br><span class="line">            mLifecycle.removeObserver(<span class="keyword">this</span>);</span><br><span class="line">            mOnBackPressedCallback.removeCancellable(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">if</span> (mCurrentCancellable != <span class="literal">null</span>) &#123;</span><br><span class="line">                mCurrentCancellable.cancel();</span><br><span class="line">                mCurrentCancellable = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>ComponentActivity：</strong></p>
<p><strong>关键代码：</strong><br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类的 onBackPressed 事件委托给 OnBackPressedDispatcher 。</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OnBackPressedDispatcher mOnBackPressedDispatcher =</span><br><span class="line">            <span class="keyword">new</span> OnBackPressedDispatcher(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    ComponentActivity.<span class="keyword">super</span>.onBackPressed();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"><span class="comment">// 自己的 onBackPressed 全交给 OnBackPressedDispatcher 处理。</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mOnBackPressedDispatcher.onBackPressed();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>利用注册监听的方式，可以很好的结偶代码，可以activity的功能分发到各个能够访问activity对象的组件上。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/3262738-b23b9fde057bbdd1.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="配个图"></p>
</div><div class="post-copyright"><blockquote><p>原文作者: wzmyyj</p><p>原文链接: <a href="https://wzmyyj.top/2020/05/11/android_4/">https://wzmyyj.top/2020/05/11/android_4/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/tags/android/">android</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2020/05/12/android_5/" class="pre">ClickableSpan的一点点摸索</a><a href="/2020/05/10/android_3/" class="next">LiveData实现消息总线</a></div><div id="comments"></div></div></div></div><div class="layout-r hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/07/21/android_10/">IM中群消息发送者信息刷新方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/21/android_9/">IM中按名称拼音字母分组排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/21/android_8/">IM项目中群成员获取与缓存策略</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/20/story_2/">小故事：未熟的果实</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/19/android_7/">IM项目中的自定义小表情实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/12/android_6/">TextView识别文本中的超链接并能点击跳转</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/12/android_5/">ClickableSpan的一点点摸索</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/11/android_4/">Fragment 监听返回按键</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/10/android_3/">LiveData实现消息总线</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/13/kotlin_1/">kotlin使用let报java.lang.NoClassDefFoundError</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/IT/" style="font-size: 15px;">IT</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/kotlin/" style="font-size: 15px;">kotlin</a> <a href="/tags/图片/" style="font-size: 15px;">图片</a> <a href="/tags/故事/" style="font-size: 15px;">故事</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://shiyi.today/" title="李昊昊：诗意" target="_blank">李昊昊：诗意</a><ul></ul><a href="https://wangzeliangbsd.github.io/" title="王亮亮：WZL Blog" target="_blank">王亮亮：WZL Blog</a><ul></ul><a href="https://foreverlf.github.io/" title="方胖子：ForeverLF" target="_blank">方胖子：ForeverLF</a><ul></ul><a href="https://zqhgit.github.io/" title="曾小辉：Sprider" target="_blank">曾小辉：Sprider</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p><span> Copyright &copy;<a href="/." rel="nofollow">wzmyyj.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=2.0.5"></script><div id="fullscreen-img" class="hide"><span class="close"></span></div><script type="text/javascript" src="/js/imgview.js?v=2.0.5" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.5" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/assets/koharu.model.json"},"display":{"superSample":2,"width":100,"height":200,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":false,"scale":0.1},"react":{"opacityDefault":1,"opacityOnHover":0.2}});</script></body></html>